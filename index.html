<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
            min-height: 400px;
        }

        @media (max-width: 600px) {
            .content {
                padding: 15px;
            }
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .workout-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .workout-types {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        .workout-btn {
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .workout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .workout-btn.push { border-color: #ff6b6b; color: #ff6b6b; }
        .workout-btn.pull { border-color: #4ecdc4; color: #4ecdc4; }
        .workout-btn.legs { border-color: #ffd93d; color: #c7a500; }
        .workout-btn.upper { border-color: #a8dadc; color: #457b9d; }
        .workout-btn.lower { border-color: #f4a261; color: #e76f51; }
        .workout-btn.whole { border-color: #b197fc; color: #7950f2; }
        .workout-btn.rest { border-color: #95e1d3; color: #38ada9; }

        .exercise-list {
            margin-top: 30px;
        }

        .exercise-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exercise-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3436;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .sets-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .set-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            font-size: 0.85em;
            color: #6c757d;
            font-weight: 600;
        }

        .control-value {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .value-input {
            width: 70px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            font-size: 1em;
        }

        .notes-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .notes-display {
            background: #fff9db;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #2d3436;
            white-space: pre-wrap;
        }

        .notes-display.empty {
            display: none;
        }

        .add-exercise-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #2d3436;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn.save {
            background: #667eea;
            color: white;
        }

        .modal-btn.cancel {
            background: #e9ecef;
            color: #6c757d;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .calendar {
                gap: 3px;
            }
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .calendar-header h2 {
            color: #2d3436;
            font-size: 1.3em;
        }

        @media (max-width: 600px) {
            .calendar-header h2 {
                font-size: 1.1em;
            }
        }

        .month-nav {
            display: flex;
            gap: 10px;
        }

        .month-nav button {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .day-label {
            text-align: center;
            font-weight: 600;
            color: #6c757d;
            padding: 8px 5px;
            font-size: 0.85em;
        }

        @media (max-width: 600px) {
            .day-label {
                padding: 5px 2px;
                font-size: 0.7em;
            }
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px;
            min-height: 50px;
        }

        @media (max-width: 600px) {
            .calendar-day {
                border-radius: 4px;
                border-width: 1px;
                padding: 2px;
                min-height: 40px;
                font-size: 0.85em;
            }
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .calendar-day.empty {
            border: none;
            cursor: default;
        }

        .calendar-day.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 3px;
        }

        .calendar-day.push { background: #ffe0e0; border-color: #ff6b6b; }
        .calendar-day.pull { background: #d4f4f2; border-color: #4ecdc4; }
        .calendar-day.legs { background: #fff9db; border-color: #ffd93d; }
        .calendar-day.upper { background: #e0f4ff; border-color: #a8dadc; }
        .calendar-day.lower { background: #ffe8d9; border-color: #f4a261; }
        .calendar-day.whole { background: #ead8ff; border-color: #b197fc; }
        .calendar-day.rest { background: #d9f7f0; border-color: #95e1d3; }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .workout-date {
            color: #6c757d;
            font-size: 0.9em;
        }

        .finish-btn {
            background: #51cf66;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }

        .save-template-btn {
            background: #4c6ef5;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }

        .view-mode {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .view-mode-label {
            color: #51cf66;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .workout-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .workout-type-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .badge-push { background: #ffe0e0; color: #ff6b6b; }
        .badge-pull { background: #d4f4f2; color: #4ecdc4; }
        .badge-legs { background: #fff9db; color: #c7a500; }
        .badge-upper { background: #e0f4ff; color: #457b9d; }
        .badge-lower { background: #ffe8d9; color: #e76f51; }
        .badge-whole { background: #ead8ff; color: #7950f2; }
        .badge-rest { background: #d9f7f0; color: #38ada9; }

        .edit-workout-btn {
            background: #4c6ef5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-buttons button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Workout Tracker</h1>
            <p>Progressive Overload Made Simple</p>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="showScreen('home')">Home</button>
            <button class="nav-btn" onclick="showScreen('calendar')">Calendar</button>
            <button class="nav-btn" onclick="showScreen('stats')">Stats</button>
        </div>

        <div class="content">
            <!-- Home Screen -->
            <div id="home" class="screen active">
                <h2>Select Workout Type</h2>
                <div class="workout-types">
                    <button class="workout-btn push" onclick="startWorkout('push')">Push</button>
                    <button class="workout-btn pull" onclick="startWorkout('pull')">Pull</button>
                    <button class="workout-btn legs" onclick="startWorkout('legs')">Legs</button>
                    <button class="workout-btn upper" onclick="startWorkout('upper')">Upper</button>
                    <button class="workout-btn lower" onclick="startWorkout('lower')">Lower</button>
                    <button class="workout-btn whole" onclick="startWorkout('whole')">Whole Body</button>
                    <button class="workout-btn rest" onclick="markRest()">Rest Day</button>
                </div>
            </div>

            <!-- Workout Screen -->
            <div id="workout" class="screen">
                <button class="back-btn" onclick="goBackFromWorkout()">‚Üê Back</button>
                <div class="workout-header">
                    <h2 id="workoutTitle">Workout</h2>
                    <div class="workout-date" id="workoutDate"></div>
                </div>
                <div id="viewModeIndicator"></div>
                <div id="exerciseList" class="exercise-list"></div>
                <div id="workoutActions"></div>
            </div>

            <!-- Calendar Screen -->
            <div id="calendar" class="screen">
                <div class="calendar-header">
                    <h2 id="calendarMonth"></h2>
                    <div class="month-nav">
                        <button onclick="changeMonth(-1)">‚Üê</button>
                        <button onclick="changeMonth(1)">‚Üí</button>
                    </div>
                </div>
                <div class="calendar" id="calendarGrid"></div>
            </div>

            <!-- Stats Screen -->
            <div id="stats" class="screen">
                <h2>Your Progress</h2>
                <div class="stats" id="statsContainer"></div>
            </div>
        </div>
    </div>

    <!-- Add Exercise Modal -->
    <div id="exerciseModal" class="modal">
        <div class="modal-content">
            <h2>Add Exercise</h2>
            <div class="form-group">
                <label>Exercise Name</label>
                <input type="text" id="exerciseName" placeholder="e.g., Bench Press">
            </div>
            <div class="form-group">
                <label>Sets</label>
                <input type="number" id="exerciseSets" value="3" min="1">
            </div>
            <div class="form-group">
                <label>Reps</label>
                <input type="number" id="exerciseReps" value="10" min="1">
            </div>
            <div class="form-group">
                <label>Weight (kg)</label>
                <input type="number" id="exerciseWeight" value="0" min="0" step="0.5">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeAddExercise()">Cancel</button>
                <button class="modal-btn save" onclick="addExercise()">Add Exercise</button>
            </div>
        </div>
    </div>

    <!-- View Workout Modal -->
    <div id="viewWorkoutModal" class="modal">
        <div class="modal-content">
            <h2>Workout Details</h2>
            <div id="viewWorkoutContent"></div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeViewWorkout()">Close</button>
                <button class="modal-btn save" onclick="editWorkoutFromModal()">Edit Workout</button>
            </div>
        </div>
    </div>

    <!-- Select Workout Type Modal -->
    <div id="selectWorkoutModal" class="modal">
        <div class="modal-content">
            <h2>Log Workout for <span id="selectedDateDisplay"></span></h2>
            <div class="workout-types" style="margin-top: 20px;">
                <button class="workout-btn push" onclick="startWorkoutForDate('push')">Push</button>
                <button class="workout-btn pull" onclick="startWorkoutForDate('pull')">Pull</button>
                <button class="workout-btn legs" onclick="startWorkoutForDate('legs')">Legs</button>
                <button class="workout-btn upper" onclick="startWorkoutForDate('upper')">Upper</button>
                <button class="workout-btn lower" onclick="startWorkoutForDate('lower')">Lower</button>
                <button class="workout-btn whole" onclick="startWorkoutForDate('whole')">Whole Body</button>
                <button class="workout-btn rest" onclick="startWorkoutForDate('rest')">Rest Day</button>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeSelectWorkout()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <h2>Exercise Notes</h2>
            <div class="form-group">
                <label>Notes (form, feeling, adjustments, etc.)</label>
                <textarea id="notesText" rows="5" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; font-family: inherit; resize: vertical;"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeNotes()">Cancel</button>
                <button class="modal-btn save" onclick="saveNotes()">Save Notes</button>
            </div>
        </div>
    </div>

    <script>
        // localStorage implementation
        const storage = {
            _workouts: null,
            
            get workouts() {
                if (!this._workouts) {
                    this._workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                }
                return this._workouts;
            },
            
            set workouts(value) {
                this._workouts = value;
                localStorage.setItem('workouts', JSON.stringify(value));
            },
            
            saveWorkouts() {
                localStorage.setItem('workouts', JSON.stringify(this._workouts));
            },
            
            currentWorkout: null,
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            isViewMode: false,
            editingWorkoutId: null,
            selectedDate: null
        };

        // Exercise templates
        const templates = {
            push: ['Bench Press', 'Overhead Press', 'Incline Dumbbell Press', 'Tricep Dips'],
            pull: ['Pull-ups', 'Barbell Row', 'Lat Pulldown', 'Bicep Curls'],
            legs: ['Squats', 'Deadlift', 'Leg Press', 'Leg Curls'],
            upper: ['Bench Press', 'Pull-ups', 'Overhead Press', 'Barbell Row'],
            lower: ['Squats', 'Romanian Deadlift', 'Leg Press', 'Calf Raises'],
            whole: ['Squats', 'Bench Press', 'Deadlift', 'Pull-ups', 'Overhead Press']
        };

        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(screenName).classList.add('active');
            
            const navBtns = document.querySelectorAll('.nav-btn');
            if (screenName === 'home') navBtns[0].classList.add('active');
            if (screenName === 'calendar') navBtns[1].classList.add('active');
            if (screenName === 'stats') navBtns[2].classList.add('active');

            if (screenName === 'calendar') renderCalendar();
            if (screenName === 'stats') renderStats();
        }

        function startWorkout(type, date = null) {
            storage.isViewMode = false;
            storage.editingWorkoutId = null;
            
            storage.currentWorkout = {
                id: Date.now(),
                type: type,
                date: date ? date : new Date().toISOString(),
                exercises: templates[type].map(name => ({
                    name: name,
                    sets: 3,
                    reps: 10,
                    weight: 0,
                    notes: ''
                }))
            };

            document.getElementById('workoutTitle').textContent = type.charAt(0).toUpperCase() + type.slice(1) + ' Workout';
            document.getElementById('workoutDate').textContent = new Date(storage.currentWorkout.date).toLocaleDateString();
            document.getElementById('viewModeIndicator').innerHTML = '';
            renderExercises();
            renderWorkoutActions();
            showScreen('workout');
        }

        function markRest() {
            storage.workouts.push({
                id: Date.now(),
                type: 'rest',
                date: new Date().toISOString(),
                exercises: []
            });
            storage.saveWorkouts();
            alert('Rest day marked! üí§');
            renderCalendar();
        }

        function renderExercises() {
            const container = document.getElementById('exerciseList');
            container.innerHTML = '';

            if (!storage.currentWorkout || !storage.currentWorkout.exercises) return;

            storage.currentWorkout.exercises.forEach((ex, idx) => {
                const div = document.createElement('div');
                div.className = 'exercise-item';
                
                if (storage.isViewMode) {
                    // View mode - no controls
                    div.innerHTML = `
                        <div class="exercise-header">
                            <div class="exercise-name">${ex.name}</div>
                        </div>
                        <div class="sets-container">
                            <div style="color: #6c757d;">
                                <strong>${ex.sets}</strong> sets √ó <strong>${ex.reps}</strong> reps @ <strong>${ex.weight}</strong> kg
                            </div>
                            ${ex.notes ? `<div class="notes-display">${ex.notes}</div>` : ''}
                        </div>
                    `;
                } else {
                    // Edit mode - with controls
                    div.innerHTML = `
                        <div class="exercise-header">
                            <div class="exercise-name">${ex.name}</div>
                            <button class="delete-btn" onclick="deleteExercise(${idx})">Delete</button>
                        </div>
                        <div class="sets-container">
                            <div class="set-controls">
                                <div class="control-item">
                                    <label>Sets</label>
                                    <div class="control-value">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'sets', -1)">‚àí</button>
                                        <input type="number" class="value-input" value="${ex.sets}" 
                                               onchange="updateValue(${idx}, 'sets', this.value)" min="1">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'sets', 1)">+</button>
                                    </div>
                                </div>
                                <div class="control-item">
                                    <label>Reps</label>
                                    <div class="control-value">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'reps', -1)">‚àí</button>
                                        <input type="number" class="value-input" value="${ex.reps}" 
                                               onchange="updateValue(${idx}, 'reps', this.value)" min="1">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'reps', 1)">+</button>
                                    </div>
                                </div>
                                <div class="control-item">
                                    <label>Weight (kg)</label>
                                    <div class="control-value">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'weight', -2.5)">‚àí</button>
                                        <input type="number" class="value-input" value="${ex.weight}" step="0.5"
                                               onchange="updateValue(${idx}, 'weight', this.value)" min="0">
                                        <button class="control-btn" onclick="changeValue(${idx}, 'weight', 2.5)">+</button>
                                    </div>
                                </div>
                            </div>
                            <button class="notes-btn" onclick="openNotes(${idx})">üìù ${ex.notes ? 'Edit Notes' : 'Add Notes'}</button>
                            ${ex.notes ? `<div class="notes-display">${ex.notes}</div>` : ''}
                        </div>
                    `;
                }
                
                container.appendChild(div);
            });
        }

        function renderWorkoutActions() {
            const container = document.getElementById('workoutActions');
            
            if (storage.isViewMode) {
                container.innerHTML = `
                    <div class="action-buttons">
                        <button class="save-template-btn" onclick="editCurrentWorkout()">Edit Workout</button>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <button class="add-exercise-btn" onclick="openAddExercise()">+ Add Exercise</button>
                    <div class="action-buttons">
                        <button class="save-template-btn" onclick="saveWorkout()">Save Workout</button>
                        <button class="finish-btn" onclick="finishWorkout()">Finish & Save</button>
                    </div>
                `;
            }
        }

        function changeValue(exIdx, field, delta) {
            const ex = storage.currentWorkout.exercises[exIdx];
            if (field === 'sets') {
                ex.sets = Math.max(1, ex.sets + delta);
            } else if (field === 'reps') {
                ex.reps = Math.max(1, ex.reps + delta);
            } else {
                ex.weight = Math.max(0, ex.weight + delta);
            }
            renderExercises();
        }

        function updateValue(exIdx, field, value) {
            const ex = storage.currentWorkout.exercises[exIdx];
            ex[field] = parseFloat(value) || 0;
            renderExercises();
        }

        function deleteExercise(idx) {
            storage.currentWorkout.exercises.splice(idx, 1);
            renderExercises();
        }

        function openAddExercise() {
            document.getElementById('exerciseModal').classList.add('active');
        }

        function closeAddExercise() {
            document.getElementById('exerciseModal').classList.remove('active');
        }

        function addExercise() {
            const name = document.getElementById('exerciseName').value;
            const sets = parseInt(document.getElementById('exerciseSets').value);
            const reps = parseInt(document.getElementById('exerciseReps').value);
            const weight = parseFloat(document.getElementById('exerciseWeight').value);

            if (!name) {
                alert('Please enter exercise name');
                return;
            }

            storage.currentWorkout.exercises.push({ name, sets, reps, weight, notes: '' });
            renderExercises();
            closeAddExercise();

            // Reset form
            document.getElementById('exerciseName').value = '';
            document.getElementById('exerciseSets').value = '3';
            document.getElementById('exerciseReps').value = '10';
            document.getElementById('exerciseWeight').value = '0';
        }

        function openNotes(exIdx) {
            storage.editingNotesIndex = exIdx;
            const ex = storage.currentWorkout.exercises[exIdx];
            document.getElementById('notesText').value = ex.notes || '';
            document.getElementById('notesModal').classList.add('active');
        }

        function closeNotes() {
            document.getElementById('notesModal').classList.remove('active');
        }

        function saveNotes() {
            const notes = document.getElementById('notesText').value;
            storage.currentWorkout.exercises[storage.editingNotesIndex].notes = notes;
            renderExercises();
            closeNotes();
        }

        function saveWorkout() {
            const existingIdx = storage.workouts.findIndex(w => w.id === storage.currentWorkout.id);
            
            if (existingIdx >= 0) {
                storage.workouts[existingIdx] = {...storage.currentWorkout};
            } else {
                storage.workouts.push({...storage.currentWorkout});
            }
            storage.saveWorkouts();
            
            alert('Workout saved! You can continue editing or finish.');
        }

        function finishWorkout() {
            const existingIdx = storage.workouts.findIndex(w => w.id === storage.currentWorkout.id);
            
            if (existingIdx >= 0) {
                storage.workouts[existingIdx] = {...storage.currentWorkout};
            } else {
                storage.workouts.push({...storage.currentWorkout});
            }
            storage.saveWorkouts();
            
            alert('Workout completed! üí™');
            storage.currentWorkout = null;
            storage.isViewMode = false;
            showScreen('home');
        }

        function goBackFromWorkout() {
            if (storage.isViewMode) {
                storage.isViewMode = false;
                storage.currentWorkout = null;
                showScreen('calendar');
            } else {
                showScreen('home');
            }
        }

        function editCurrentWorkout() {
            storage.isViewMode = false;
            renderExercises();
            renderWorkoutActions();
        }

        function viewWorkout(workoutId) {
            const workout = storage.workouts.find(w => w.id === workoutId);
            if (!workout) return;

            storage.currentWorkout = JSON.parse(JSON.stringify(workout));
            storage.isViewMode = true;

            document.getElementById('workoutTitle').textContent = 
                workout.type.charAt(0).toUpperCase() + workout.type.slice(1) + ' Workout';
            document.getElementById('workoutDate').textContent = 
                new Date(workout.date).toLocaleDateString();
            
            document.getElementById('viewModeIndicator').innerHTML = `
                <div class="view-mode">
                    <div class="view-mode-label">‚úì Completed Workout</div>
                </div>
            `;

            renderExercises();
            renderWorkoutActions();
            showScreen('workout');
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[storage.currentMonth]} ${storage.currentYear}`;

            const firstDay = new Date(storage.currentYear, storage.currentMonth, 1).getDay();
            const daysInMonth = new Date(storage.currentYear, storage.currentMonth + 1, 0).getDate();

            grid.innerHTML = '';
            
            // Day labels
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const label = document.createElement('div');
                label.className = 'day-label';
                label.textContent = day;
                grid.appendChild(label);
            });

            // Empty cells
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                grid.appendChild(empty);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                const date = new Date(storage.currentYear, storage.currentMonth, day);
                const workout = storage.workouts.find(w => 
                    new Date(w.date).toDateString() === date.toDateString()
                );

                if (workout) {
                    dayDiv.classList.add(workout.type);
                }
                
                // Make all days clickable
                dayDiv.onclick = () => {
                    if (workout) {
                        viewWorkout(workout.id);
                    } else {
                        selectDateForWorkout(date);
                    }
                };
                dayDiv.style.cursor = 'pointer';

                dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                grid.appendChild(dayDiv);
            }
        }

        function changeMonth(delta) {
            storage.currentMonth += delta;
            if (storage.currentMonth > 11) {
                storage.currentMonth = 0;
                storage.currentYear++;
            } else if (storage.currentMonth < 0) {
                storage.currentMonth = 11;
                storage.currentYear--;
            }
            renderCalendar();
        }

        function selectDateForWorkout(date) {
            storage.selectedDate = date;
            const dateStr = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('selectedDateDisplay').textContent = dateStr;
            document.getElementById('selectWorkoutModal').classList.add('active');
        }

        function closeSelectWorkout() {
            document.getElementById('selectWorkoutModal').classList.remove('active');
        }

        function startWorkoutForDate(type) {
            closeSelectWorkout();
            if (type === 'rest') {
                storage.workouts.push({
                    id: Date.now(),
                    type: 'rest',
                    date: storage.selectedDate.toISOString(),
                    exercises: []
                });
                storage.saveWorkouts();
                alert('Rest day marked! üí§');
                renderCalendar();
            } else {
                startWorkout(type, storage.selectedDate.toISOString());
            }
        }

        function renderStats() {
            const container = document.getElementById('statsContainer');
            const totalWorkouts = storage.workouts.filter(w => w.type !== 'rest').length;
            const totalRestDays = storage.workouts.filter(w => w.type === 'rest').length;
            
            let totalVolume = 0;
            storage.workouts.forEach(w => {
                w.exercises.forEach(ex => {
                    totalVolume += ex.sets * ex.reps * ex.weight;
                });
            });

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalWorkouts}</div>
                    <div class="stat-label">Total Workouts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalRestDays}</div>
                    <div class="stat-label">Rest Days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(totalVolume)}</div>
                    <div class="stat-label">Total Volume (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${storage.workouts.length}</div>
                    <div class="stat-label">Days Tracked</div>
                </div>
            `;
        }

        // Initialize
        renderCalendar();
    </script>
</body>
</html>